name: Notify Latest Release

on:
  schedule:
    - cron: '*/5 * * * *' # –∫–∞–∂–¥—ã–µ 5 –º–∏–Ω—É—Ç
  workflow_dispatch:

jobs:
  notify_latest:
    runs-on: ubuntu-latest

    steps:
      - name: Get latest release info
        id: get_release
        uses: actions/github-script@v6
        with:
          script: |
            const r = await github.rest.repos.getLatestRelease({
              owner: 'M5wiki',
              repo: 'M5wiki.github.io'
            });

            const date = new Date(r.data.published_at)
              .toLocaleDateString('ru-RU');

            core.setOutput("date", date);
            core.setOutput("version", r.data.tag_name || r.data.name || "–ë–µ–∑ –≤–µ—Ä—Å–∏–∏");
            core.setOutput("body", r.data.body || "–ù–µ—Ç –æ–ø–∏—Å–∞–Ω–∏—è");
            core.setOutput("url", r.data.html_url);

      - name: Send Telegram message
        uses: appleboy/telegram-action@v1.0.1
        with:
          token: ${{ secrets.TELEGRAM_BOT_TOKEN }}
          to: ${{ secrets.TELEGRAM_CHAT_ID }}
          message: |
            üìÖ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ new.m5wiki.tech ‚Ä¢ [${{ steps.get_release.outputs.date }}]
            –í–µ—Ä—Å–∏—è [${{ steps.get_release.outputs.version }}]

            ${{ steps.get_release.outputs.body }}

            üîó –ü–æ–¥—Ä–æ–±–Ω–µ–µ: ${{ steps.get_release.outputs.url }}
            üîó –°—Å—ã–ª–∫–∞: ${{ steps.get_release.outputs.url }}
